name: Daily Health Check

on:
  schedule:
    - cron: '0 0 * * *'  # Run daily at midnight UTC
  workflow_dispatch:  # Allow manual trigger

jobs:
  health-check:
    runs-on: ubuntu-latest
    
    steps:
    - uses: actions/checkout@v3
    
    - name: Run Health Check
      run: |
        chmod +x scripts/health-check.sh
        ./scripts/health-check.sh
    
    - name: Create Issue on Failure
      if: failure()
      uses: actions/github-script@v6
      with:
        script: |
          github.rest.issues.create({
            owner: context.repo.owner,
            repo: context.repo.repo,
            title: 'üö® Daily Health Check Failed',
            body: `## Health Check Failure Report
            
            **Date**: ${new Date().toISOString()}
            **Workflow**: ${context.workflow}
            **Run ID**: ${context.runId}
            
            ### Issue Details
            The daily health check has detected issues with the datasets API.
            
            ### Next Steps
            1. Check API endpoint availability
            2. Verify JSON file validity
            3. Test GitHub Pages deployment
            4. Review recent commits for issues
            
            ### Links
            - [Failed Workflow Run](${context.payload.repository.html_url}/actions/runs/${context.runId})
            - [API Base URL](https://klubfisika.github.io/datasets/)
            
            This issue was automatically created by the health check workflow.`,
            labels: ['bug', 'automated', 'health-check']
          })
    
    - name: Notify on Success
      if: success()
      run: |
        echo "‚úÖ All systems operational!"
        echo "üìä API endpoints: Working"
        echo "üîç JSON validation: Passed"
        echo "‚ö° Performance: Good"
